---
layout: post
title: "TCP & IP"
subtitle: " \"TCP&IP\""
date: 2015-11-22 14:55:20
author: "Minato"
header-img: "img/post-bg-2015.jpg"
tags:
    - TCP/IP 
    - 网络协议
---

# TCP/IP

##第一章
###服务端套接字
####1. 构建过程
1. 调用socket创建套接字（安装电话）
2. 调用bind分配IP和端口号（分配电话号码）
3. 调用listen将套接字转为可以连接状态（连接电话线）
4. 调用accept受理连接请求，有连接请求时会有返回（拿起电话筒）
5. 调用write来传输数据

###客户端套接字
####1. 构建过程
1. 调用socket创建套接字
2. 调用connect向服务端发送请求


###文件操作
####1. 文件描述符定义
文件描述符是系统分配给文件或者套接字的整数

####2.在Windows和Linux下的区别
1. Windows系统中称这个整数为句柄
2. Linux系统中称位文件描述符

####3.用途
方便程序和操作系统间的沟通而赋予的整数

####4.关于文件操作
1. Linux操作系统上不区分文件与套接字，在操作文件和套接字上使用相同的函数
2. 以_t后缀的数据类型，为操作系统定义的元数据类型

####5.Linux上文件和套接字操作的对比，无区分

        int fd1 = socket(PF_INET, SOCK_STREAM, 0);
        int fd2 = open("test.dat", O_CREAT|O_WRONLY|O_TRUNC);
        close(fd1);
        close(fd2);

####6.Windows上严格区分文件I/O函数和套接字I/O函数
1. 文件I/O使用read和write函数
2. 套接字I/O使用send和recv函数

-----

##第二章
###套接字协议
####1. 定义
约定的通信规则
####2. 协议如何运用在socket上

        int socket(int domain, int type, int protocol)
        
#####1. domain 协议族的信息
1. PF_INET IPv4协议
2. PE_INET6 IPv6协议
#####2. type 套接字类型
1. 描述：决定套接字的数据传输方式，如PE_INET存在多种传输方式
2. 面向连接的套接字SOCK_STREAM——可靠，按序，基于字节的面向连接传输方式的套接字
3. 面向消息的套接字SOCK_DGRAM——不可靠，不按序，以数据的高速传输为目的的套接字
#####3. protocol 最终采用的协议
1. 一般情况下传递0，表示前面两个参数已经可以创建唯一的套接字
2. 同一个协议族中存在多个数据传输方式系统的协议时，则需要第三个参数来指定协议信息
3. IPv4协议族中，面向连接的套接字只有IPPROTO_TCP
4. IPv4协议族中，面向消息的套接字只有IPPROTO_UDP

-----

##第三章
###IP地址和端口号
1. IP地址是为了收发网络数据而分配给计算机的值
2. 端口号是同一个操作系统内区分不同套接字而设置的值
3. TCP套接字和UDP套接字不会共用端口号，运行重复

-----

##第四章
####TCP/IP
#####1. 协议栈
1. 链路层
    + 物理链接
2. IP层
    + 解决数据传输中路径选择问题
    + 面向消息，不可靠的协议
3. 传输层
    + 决定主机间数据传输方式，TCP协议确认后向不可靠的IP协议赋予可靠性
4. 应用层
    + 编写应用中，根据程序特点决定服务端和客户端的数据传输规则

#### 基于TCP的服务端
#####1. 进入等待连接请求状态
1. 调用listen函数，socket可接收客户端连接请求的状态称为等待连接请求状态
2. 调用listen后，客户端才能进入可发送请求的状态

#####2. 受理客户端连接请求
1. 调用accept函数手里连接请求等待队列中待处理的客户端连接请求
2. 请求成功时，内部产生用于数据I/O的套接字，并返回其文件描述符，该套接字是自动与发起请求的客户端建立连接

#### 基于TCP的服务端
#####1. 调用connect进行发送连接请求，发生以下情况时才会返回
1. 服务器端接受连接请求
2. 发生断网异常时，中断连接请求

#####2. 客户端的IP地址和端口分配
1. 客户端调用connect时，自动分配，无需进行bind函数分配

####TCP原理
#####1. TCP套接字中I/O缓冲
1. TCP数据收发无边界，即字节数的读写，可以分多次函数调用进行
2. write调用后，并非立即传输数据，调用瞬间，数据将移至输出缓冲，适当时传向对方的输入缓冲
 
#####2. 缓冲特性
1. I/O缓冲在每个TCP套接字中单独存在
2. I/O缓冲在创建套接字时自动生成
3. 关闭套接字，也会继续传递输出缓冲中遗留的数据
4. 关闭套接字，将丢失输入缓冲中的数据

#####3. 滑动窗口协议
1. 不会发生超过输入缓冲大小的数据传输
2. 不会因为缓冲溢出而丢失数据

#####4. 三次握手
1. 与对方套接字建立连接
2. 与对方套接字进行数据交换
3. 断开与对方套接字的连接

##第六章
###UDP
####1. 与TCP的区别
1. 流控制是区分TCP和UDP的重要标志

####2. 原理
1. 根据端口号，将主机的数据包交付给最终UDP套接字

####3. TCP比UDP慢的主要原因
1. 收发数据前后进行连接设置及清除过程
2. 收发数据过程中为保证可靠性而添加的流控制

####4. 基于UDP的客户端和服务端实现
1. 只需要创建套接字过程和数据交换过程
2. UDP不会保持连接状态，每次传输数据都要添加目标地址信息
3. 调用sendto即会自动分配IP和端口

####5.UDP数据传输特效
#####1. TCP不存在数据边界，传输过程中调用I/O函数的次数不具备任何意义
#####2. UDP具有数据边界协议，调用I/O函数的次数读写必须一致
#####3. UDP也可以调用connect函数，不是为了建立连接，而是注册目标IP和端口号

##第八章
###域名和网络地址
####1. 域名是赋予服务端的虚拟地址，IP才是真实地址
####2. DNS服务器则是负责解析域名为IP地址

##第十章
###多并发的服务器
1. 多进程的服务器
2. 基于select函数实现
    * 同时监视多个文件描述符（套接字）
3. 基于epoll函数实现的并发
    * 原理和select一样，不同在于用操作系统负责保存监视对象文件描述符
4. 多线程的服务端






------

Copyright 2015 WangLin

<!-- create time: 2015-11-22 14:55:20  -->
