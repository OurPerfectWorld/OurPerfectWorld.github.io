# 资源管理器

----
###参考资料：《我所理解的Cocos2d-x》第五章纹理
###纹理的缓存管理
+ 前提介绍：
	1. 一个纹理对象由Texture2D管理，Texture2D创建时会从磁盘读取数据并上传到GPU内存中
	2. TextureCache管理多个Texture2D的生命周期
+ TextureCache的功能：
	1. 负责纹理的创建，缓存和删除
	2. 对每个纹理对应的Texture2D对象创建对应的索引值（索引值为文件的全路径或手动设置）
	3. 动态加载纹理**addImageAsync**
+ TextureCache管理的好处     
    1. Sprite构建时创建Texture2D对象并进行引用，在Sprite移除时对应进行销毁，这样导致其他的想使用该Texture2D的对象无法进行应用
    2. 使用TextureCache对Texture2D进行管理：
         + 加载该纹理对象时，引用为1。
         + 有Sprite等对象对该纹理进行使用，则引用+1
         + Sprite对象移除，引用-1；
         + 确定该纹理不需要，TextureCache使用**removeTexture**移除引用，执行release操作；此时的引用计数为正在被使用的元素个数；
         + 引用为1，表示空闲状态，使用**removeUnusedTextures**的方法来移除空闲的纹理来释放资源；
         + 当所有的纹理不再被使用时，使用**removeAllTexture**进行移除；     

###使用引用计数的资源管理器
+ 前提：资源类型
    1. 各场景都用的通用资源；
    2. 特定场景使用的特定资源；
    3. 加载动画的过渡资源；
    4. 需要动态加载的不可预测资源；
+ 思路：
    1. 对每个资源进行引用计数；
    2. 该计数不是内存上的计数，而是逻辑上对资源的使用；
+ 工作流程：
    1. 进入场景或关卡时，对需要使用的资源引用计数加一；
    2. 对上一个场景或关卡使用的所有资源的引用计数减一；
    3. 删除内存中引用计数为0的资源；
    4. 引用计数为1，可能是新加的资源，也可能是复用资源；
    
###场景资源管理器
+ 思路：
    1. 统一对各种类型和资源，如纹理、音频和XML等进行处理；
    2. 利用缓存机制处理资源的运行时的创建，缓存和删除，共享，如TextureCache、XMLCache、AudioCache等等；
    3. 利用引用计数机制管理多个场景之间资源的过渡和共享；
+ 工作流程：
    1. XXXCache负责对资源的内存引用管理；
    2. ResourceManager负责逻辑上的资源引用计数管理，对资源的加载等操作封装在里面，程序只和ResourceManager交互；
    3. 在ResourceManager中管理场景关卡等所有各种用到的资源列表；
+ 优缺点：
    1. 解决场景之间的资源共享问题；
    2. 无法解决临时性或场景内短暂存在的资源问题；
    
   
------

Copyright 2015 WangLin
<!-- create time: 2015-01-24 17:36:47  -->
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   